<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio Sample Drop, Playback, and Effects</title>
    <style>
        #drop_zone {
            border: 2px dashed #007bff;
            border-radius: 5px;
            padding: 50px;
            text-align: center;
            margin: 20px;
        }
        
        #audio_visualizer {
            width: 100%;
            height: 100px;
            background-color: #f3f3f3;
            display: block;
            margin-top: 20px;
        }
        
        #controls {
            margin: 20px;
            text-align: center;
        }
        
        label {
            margin-right: 10px;
        }
    </style>
</head>
<body>

<div id="drop_zone">
    <p>Drag one audio file here to play it.</p>
</div>
<div id="controls">
    <label for="pitchSlider">Pitch Control:</label>
    <input type="range" id="pitchSlider" min="0.5" max="2" value="1" step="0.01">
</div>
<canvas id="audio_visualizer"></canvas>
<audio id="audio_player" controls></audio>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    var sourceNode;
    var dropZone = document.getElementById('drop_zone');
    var pitchSlider = document.getElementById('pitchSlider');
    var canvas = document.getElementById('audio_visualizer');
    var canvasCtx = canvas.getContext('2d');

    function drawWaveform(buffer) {
        var data = buffer.getChannelData(0);
        var step = Math.ceil(data.length / canvas.width);
        var amp = canvas.height / 2;
        canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
        canvasCtx.beginPath();
        for (var i = 0; i < canvas.width; i++) {
            var min = 1.0;
            var max = -1.0;
            for (var j = 0; j < step; j++) {
                var datum = data[(i * step) + j];
                if (datum < min) min = datum;
                if (datum > max) max = datum;
            }
            canvasCtx.fillRect(i, (1 + min) * amp, 1, Math.max(1, (max - min) * amp));
        }
    }

    dropZone.addEventListener('dragover', function(ev) {
        ev.preventDefault();
    });

    dropZone.addEventListener('drop', function(ev) {
        ev.preventDefault();
        if (ev.dataTransfer.items) {
            var file = ev.dataTransfer.items[0].getAsFile();
            var reader = new FileReader();
            reader.onload = function(e) {
                audioCtx.decodeAudioData(e.target.result, function(buffer) {
                    if (sourceNode) {
                        sourceNode.disconnect();
                    }
                    sourceNode = audioCtx.createBufferSource();
                    sourceNode.buffer = buffer;
                    sourceNode.connect(audioCtx.destination);
                    drawWaveform(buffer);
                    sourceNode.start(0);
                    pitchSlider.oninput = function() {
                        var playbackRate = parseFloat(pitchSlider.value);
                        sourceNode.playbackRate.value = playbackRate;
                    };
                });
            };
            reader.readAsArrayBuffer(file);
        }
    });
});
</script>
</body>
</html>
